version: "3"
networks:
    receiver_net:
        driver: bridge
        ipam:
            driver: default
            config:
                - subnet: 10.0.0.0/16
services:
  comet:
    image: "nritsche/comet"
    build: ./comet
    networks:
      - receiver_net
      - default
      #- comet_net
    # should overwrite these in compose file
    hostname: comet
    ports:
      - "12050:12050"
    networks:
      receiver_net:
        # address needs to match that in kotekan config yaml's
        ipv4_address: 10.0.1.3
  gpu:
      image: nritsche/kotekan-gpu
      volumes:
          - ./kotekan/:/code
          - ./:/test
      environment:
          KOTEKAN_CONFIG: /test/gpu.yaml
      hostname: cn01
      ports:
          - "12100-12109:12048"
  recv:
    image: nritsche/kotekan-receiver
    volumes:
      - ./kotekan/:/code
      - ./:/test
    environment:
      KOTEKAN_CONFIG: /test/recv.yaml
      RUN_DATASET_BROKER: 1
    hostname: recv-1
    ports:
      - "12049:12048"
    networks:
      receiver_net:
        # address needs to match that in receiver config yaml
        ipv4_address: 10.0.1.2
